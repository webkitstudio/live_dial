(function(b){var d={extend:function(){arguments[0]=arguments[0]||{};for(var f=1;f<arguments.length;f++){for(var e in arguments[f]){if(arguments[f].hasOwnProperty(e)){if(typeof(arguments[f][e])==="object"){if(arguments[f][e] instanceof Array){arguments[0][e]=arguments[f][e]}else{arguments[0][e]=d.extend(arguments[0][e],arguments[f][e])}}else{arguments[0][e]=arguments[f][e]}}}}return arguments[0]}};function a(e){this.options=d.extend({},a.defaultOptions,e);this.clear()}a.defaultOptions={resetBoundsInterval:3000,resetBounds:true};a.prototype.clear=function(){this.data=[];this.maxValue=Number.NaN;this.minValue=Number.NaN};a.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1];this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var f=this.data[e][1];if(f>this.maxValue){this.maxValue=f}if(f<this.minValue){this.minValue=f}}}else{this.maxValue=Number.NaN;this.minValue=Number.NaN}};a.prototype.append=function(h,g,f){var e=this.data.length-1;while(e>=0&&this.data[e][0]>h){e--}if(e===-1){this.data.splice(0,0,[h,g])}else{if(this.data.length>0&&this.data[e][0]===h){if(f){this.data[e][1]+=g;g=this.data[e][1]}else{this.data[e][1]=g}}else{if(e<this.data.length-1){this.data.splice(e+1,0,[h,g])}else{this.data.push([h,g])}}}this.maxValue=isNaN(this.maxValue)?g:Math.max(this.maxValue,g);this.minValue=isNaN(this.minValue)?g:Math.min(this.minValue,g)};a.prototype.dropOldData=function(e,f){var g=0;while(this.data.length-g>=f&&this.data[g+1][0]<e){g++}if(g!==0){this.data.splice(0,g)}};function c(e){this.options=d.extend({},c.defaultChartOptions,e);this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0;this.lastRenderTimeMillis=0}c.defaultChartOptions={millisPerPixel:20,enableDpiScaling:true,yMinFormatter:function(f,e){return parseFloat(f).toFixed(e)},yMaxFormatter:function(e,f){return parseFloat(e).toFixed(f)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:0.125,maxDataSetLength:2,scrollBackwards:false,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:false,millisPerLine:1000,verticalSections:2,borderVisible:true},labels:{fillStyle:"#ffffff",disabled:false,fontSize:10,fontFamily:"monospace",precision:2},horizontalLines:[]};c.AnimateCompatibility=(function(){var f=function(i,g){var h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(j){return window.setTimeout(function(){j(new Date().getTime())},16)};return h.call(window,i,g)},e=function(h){var g=window.cancelAnimationFrame||function(i){clearTimeout(i)};return g.call(window,h)};return{requestAnimationFrame:f,cancelAnimationFrame:e}})();c.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"};c.prototype.addTimeSeries=function(f,e){this.seriesSet.push({timeSeries:f,options:d.extend({},c.defaultSeriesPresentationOptions,e)});if(f.options.resetBounds&&f.options.resetBoundsInterval>0){f.resetBoundsTimerId=setInterval(function(){f.resetBounds()},f.options.resetBoundsInterval)}};c.prototype.removeTimeSeries=function(g){var f=this.seriesSet.length;for(var e=0;e<f;e++){if(this.seriesSet[e].timeSeries===g){this.seriesSet.splice(e,1);break}}if(g.resetBoundsTimerId){clearInterval(g.resetBoundsTimerId)}};c.prototype.getTimeSeriesOptions=function(g){var f=this.seriesSet.length;for(var e=0;e<f;e++){if(this.seriesSet[e].timeSeries===g){return this.seriesSet[e].options}}};c.prototype.bringToFront=function(g){var f=this.seriesSet.length;for(var e=0;e<f;e++){if(this.seriesSet[e].timeSeries===g){var h=this.seriesSet.splice(e,1);this.seriesSet.push(h[0]);break}}};c.prototype.streamTo=function(e,f){this.canvas=e;this.delay=f;this.start()};c.prototype.resize=function(){if(!this.options.enableDpiScaling||!window||window.devicePixelRatio===1){return}var g=window.devicePixelRatio;var f=parseInt(this.canvas.getAttribute("width"));var e=parseInt(this.canvas.getAttribute("height"));if(!this.originalWidth||(Math.floor(this.originalWidth*g)!==f)){this.originalWidth=f;this.canvas.setAttribute("width",(Math.floor(f*g)).toString());this.canvas.style.width=f+"px";this.canvas.getContext("2d").scale(g,g)}if(!this.originalHeight||(Math.floor(this.originalHeight*g)!==e)){this.originalHeight=e;this.canvas.setAttribute("height",(Math.floor(e*g)).toString());this.canvas.style.height=e+"px";this.canvas.getContext("2d").scale(g,g)}};c.prototype.start=function(){if(this.frame){return}var e=function(){this.frame=c.AnimateCompatibility.requestAnimationFrame(function(){this.render();e()}.bind(this))}.bind(this);e()};c.prototype.stop=function(){if(this.frame){c.AnimateCompatibility.cancelAnimationFrame(this.frame);delete this.frame}};c.prototype.updateValueRange=function(){var g=this.options,j=Number.NaN,k=Number.NaN;for(var i=0;i<this.seriesSet.length;i++){var m=this.seriesSet[i].timeSeries;if(!isNaN(m.maxValue)){j=!isNaN(j)?Math.max(j,m.maxValue):m.maxValue}if(!isNaN(m.minValue)){k=!isNaN(k)?Math.min(k,m.minValue):m.minValue}}if(g.maxValue!=null){j=g.maxValue}else{j*=g.maxValueScale}if(g.minValue!=null){k=g.minValue}else{k-=Math.abs(k*g.minValueScale-k)}if(this.options.yRangeFunction){var h=this.options.yRangeFunction({min:k,max:j});k=h.min;j=h.max}if(!isNaN(j)&&!isNaN(k)){var e=j-k;var f=(e-this.currentValueRange);var l=(k-this.currentVisMinValue);this.isAnimatingScale=Math.abs(f)>0.1||Math.abs(l)>0.1;this.currentValueRange+=g.scaleSmoothing*f;this.currentVisMinValue+=g.scaleSmoothing*l}this.valueRange={min:k,max:j}};c.prototype.render=function(j,n){var p=new Date().getTime();if(!this.isAnimatingScale){var E=Math.min(1000/6,this.options.millisPerPixel);if(p-this.lastRenderTimeMillis<E){return}}this.resize();this.lastRenderTimeMillis=p;j=j||this.canvas;n=n||p-(this.delay||0);n-=n%this.options.millisPerPixel;var g=j.getContext("2d"),L=this.options,l={top:0,left:0,width:j.clientWidth,height:j.clientHeight},I=n-(l.width*L.millisPerPixel),r=function(i){var t=i-this.currentVisMinValue;return this.currentValueRange===0?l.height:l.height-(Math.round((t/this.currentValueRange)*l.height))}.bind(this),G=function(i){if(L.scrollBackwards){return Math.round((n-i)/L.millisPerPixel)}return Math.round(l.width-((n-i)/L.millisPerPixel))};this.updateValueRange();g.font=L.labels.fontSize+"px "+L.labels.fontFamily;g.save();g.translate(l.left,l.top);g.beginPath();g.rect(0,0,l.width,l.height);g.clip();g.save();g.fillStyle=L.grid.fillStyle;g.clearRect(0,0,l.width,l.height);g.fillRect(0,0,l.width,l.height);g.restore();g.save();g.lineWidth=L.grid.lineWidth;g.strokeStyle=L.grid.strokeStyle;if(L.grid.millisPerLine>0){g.beginPath();for(var C=n-(n%L.grid.millisPerLine);C>=I;C-=L.grid.millisPerLine){var B=G(C);if(L.grid.sharpLines){B-=0.5}g.moveTo(B,0);g.lineTo(B,l.height)}g.stroke();g.closePath()}for(var A=1;A<L.grid.verticalSections;A++){var z=Math.round(A*l.height/L.grid.verticalSections);if(L.grid.sharpLines){z-=0.5}g.beginPath();g.moveTo(0,z);g.lineTo(l.width,z);g.stroke();g.closePath()}if(L.grid.borderVisible){g.beginPath();g.strokeRect(0,0,l.width,l.height);g.closePath()}g.restore();if(L.horizontalLines&&L.horizontalLines.length){for(var f=0;f<L.horizontalLines.length;f++){var w=L.horizontalLines[f],H=Math.round(r(w.value))-0.5;g.strokeStyle=w.color||"#ffffff";g.lineWidth=w.lineWidth||1;g.beginPath();g.moveTo(0,H);g.lineTo(l.width,H);g.stroke();g.closePath()}}for(var N=0;N<this.seriesSet.length;N++){g.save();var K=this.seriesSet[N].timeSeries,J=K.data,o=this.seriesSet[N].options;K.dropOldData(I,L.maxDataSetLength);g.lineWidth=o.lineWidth;g.strokeStyle=o.strokeStyle;g.beginPath();var u=0,m=0,k=0;for(var M=0;M<J.length&&J.length!==1;M++){var s=G(J[M][0]),q=r(J[M][1]);if(M===0){u=s;g.moveTo(s,q)}else{switch(L.interpolation){case"linear":case"line":g.lineTo(s,q);break;case"bezier":default:g.bezierCurveTo(Math.round((m+s)/2),k,Math.round((m+s))/2,q,s,q);break;case"step":g.lineTo(s,k);g.lineTo(s,q);break}}m=s;k=q}if(J.length>1){if(o.fillStyle){g.lineTo(l.width+o.lineWidth+1,k);g.lineTo(l.width+o.lineWidth+1,l.height+o.lineWidth+1);g.lineTo(u,l.height+o.lineWidth);g.fillStyle=o.fillStyle;g.fill()}if(o.strokeStyle&&o.strokeStyle!=="none"){g.stroke()}g.closePath()}g.restore()}if(!L.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var h=L.yMaxFormatter(this.valueRange.max,L.labels.precision),Q=L.yMinFormatter(this.valueRange.min,L.labels.precision),F=L.scrollBackwards?0:l.width-g.measureText(h).width-2;g.fillStyle=L.labels.fillStyle;g.fillText(h,F,L.labels.fontSize);g.fillText(Q,F,l.height-2)}if(L.timestampFormatter&&L.grid.millisPerLine>0){var P=L.scrollBackwards?g.measureText(Q).width:l.width-g.measureText(Q).width+4;for(var C=n-(n%L.grid.millisPerLine);C>=I;C-=L.grid.millisPerLine){var B=G(C);if((!L.scrollBackwards&&B<P)||(L.scrollBackwards&&B>P)){var O=new Date(C),e=L.timestampFormatter(O),D=g.measureText(e).width;P=L.scrollBackwards?B+D+2:B-D-2;g.fillStyle=L.labels.fillStyle;if(L.scrollBackwards){g.fillText(e,B,l.height-2)}else{g.fillText(e,B-D,l.height-2)}}}}g.restore()};c.timeFormatter=function(e){function f(g){return(g<10?"0":"")+g}return f(e.getHours())+":"+f(e.getMinutes())+":"+f(e.getSeconds())};b.TimeSeries=a;b.SmoothieChart=c})(typeof exports==="undefined"?this:exports);